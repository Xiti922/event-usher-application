{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.makeMultisignedTxBytes = exports.makeMultisignedTx = exports.makeCompactBitArray = void 0;\nconst amino_1 = require(\"@cosmjs/amino\");\nconst encoding_1 = require(\"@cosmjs/encoding\");\nconst proto_signing_1 = require(\"@cosmjs/proto-signing\");\nconst multisig_1 = require(\"cosmjs-types/cosmos/crypto/multisig/v1beta1/multisig\");\nconst signing_1 = require(\"cosmjs-types/cosmos/tx/signing/v1beta1/signing\");\nconst tx_1 = require(\"cosmjs-types/cosmos/tx/v1beta1/tx\");\nconst tx_2 = require(\"cosmjs-types/cosmos/tx/v1beta1/tx\");\nconst long_1 = __importDefault(require(\"long\"));\nfunction makeCompactBitArray(bits) {\n  const byteCount = Math.ceil(bits.length / 8);\n  const extraBits = bits.length - Math.floor(bits.length / 8) * 8;\n  const bytes = new Uint8Array(byteCount); // zero-filled\n  bits.forEach((value, index) => {\n    const bytePos = Math.floor(index / 8);\n    const bitPos = index % 8;\n    // eslint-disable-next-line no-bitwise\n    if (value) bytes[bytePos] |= 0b1 << 8 - 1 - bitPos;\n  });\n  return multisig_1.CompactBitArray.fromPartial({\n    elems: bytes,\n    extraBitsStored: extraBits\n  });\n}\nexports.makeCompactBitArray = makeCompactBitArray;\n/**\n * Creates a signed transaction from signer info, transaction body and signatures.\n * The result can be broadcasted after serialization.\n *\n * Consider using `makeMultisignedTxBytes` instead if you want to broadcast the\n * transaction immediately.\n */\nfunction makeMultisignedTx(multisigPubkey, sequence, fee, bodyBytes, signatures) {\n  const addresses = Array.from(signatures.keys());\n  const prefix = (0, encoding_1.fromBech32)(addresses[0]).prefix;\n  const signers = Array(multisigPubkey.value.pubkeys.length).fill(false);\n  const signaturesList = new Array();\n  for (let i = 0; i < multisigPubkey.value.pubkeys.length; i++) {\n    const signerAddress = (0, amino_1.pubkeyToAddress)(multisigPubkey.value.pubkeys[i], prefix);\n    const signature = signatures.get(signerAddress);\n    if (signature) {\n      signers[i] = true;\n      signaturesList.push(signature);\n    }\n  }\n  const signerInfo = {\n    publicKey: (0, proto_signing_1.encodePubkey)(multisigPubkey),\n    modeInfo: {\n      multi: {\n        bitarray: makeCompactBitArray(signers),\n        modeInfos: signaturesList.map(_ => ({\n          single: {\n            mode: signing_1.SignMode.SIGN_MODE_LEGACY_AMINO_JSON\n          }\n        }))\n      }\n    },\n    sequence: long_1.default.fromNumber(sequence)\n  };\n  const authInfo = tx_1.AuthInfo.fromPartial({\n    signerInfos: [signerInfo],\n    fee: {\n      amount: [...fee.amount],\n      gasLimit: long_1.default.fromString(fee.gas)\n    }\n  });\n  const authInfoBytes = tx_1.AuthInfo.encode(authInfo).finish();\n  const signedTx = tx_2.TxRaw.fromPartial({\n    bodyBytes: bodyBytes,\n    authInfoBytes: authInfoBytes,\n    signatures: [multisig_1.MultiSignature.encode(multisig_1.MultiSignature.fromPartial({\n      signatures: signaturesList\n    })).finish()]\n  });\n  return signedTx;\n}\nexports.makeMultisignedTx = makeMultisignedTx;\n/**\n * Creates a signed transaction from signer info, transaction body and signatures.\n * The result can be broadcasted.\n *\n * This is a wrapper around `makeMultisignedTx` that encodes the transaction for broadcasting.\n */\nfunction makeMultisignedTxBytes(multisigPubkey, sequence, fee, bodyBytes, signatures) {\n  const signedTx = makeMultisignedTx(multisigPubkey, sequence, fee, bodyBytes, signatures);\n  return Uint8Array.from(tx_2.TxRaw.encode(signedTx).finish());\n}\nexports.makeMultisignedTxBytes = makeMultisignedTxBytes;","map":{"version":3,"mappings":"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","names":["makeCompactBitArray","bits","byteCount","Math","ceil","length","extraBits","floor","bytes","Uint8Array","forEach","value","index","bytePos","bitPos","multisig_1","fromPartial","elems","extraBitsStored","exports","makeMultisignedTx","multisigPubkey","sequence","fee","bodyBytes","signatures","addresses","Array","from","keys","prefix","signers","pubkeys","fill","signaturesList","i","signerAddress","signature","get","push","signerInfo","publicKey","modeInfo","multi","bitarray","modeInfos","map","_","single","mode","signing_1","SIGN_MODE_LEGACY_AMINO_JSON","long_1","fromNumber","authInfo","tx_1","signerInfos","amount","gasLimit","fromString","gas","authInfoBytes","encode","finish","signedTx","tx_2","makeMultisignedTxBytes"],"sources":["../src/multisignature.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}