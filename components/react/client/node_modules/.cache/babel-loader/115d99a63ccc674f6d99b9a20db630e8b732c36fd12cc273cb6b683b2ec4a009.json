{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\nvar _ripemd = _interopRequireDefault(require(\"ripemd160\"));\nvar _bech = _interopRequireDefault(require(\"bech32\"));\nvar _helperV = require(\"./helperV1\");\nvar _helperV2 = require(\"./helperV2\");\nvar _common = require(\"./common\");\n\n/** ******************************************************************************\n *  (c) 2019 ZondaX GmbH\n *  (c) 2016-2017 Ledger\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n ******************************************************************************* */\nvar CosmosApp = /*#__PURE__*/function () {\n  function CosmosApp(transport) {\n    var scrambleKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _common.APP_KEY;\n    (0, _classCallCheck2.default)(this, CosmosApp);\n    if (!transport) {\n      throw new Error(\"Transport has not been defined\");\n    }\n    this.transport = transport;\n    transport.decorateAppAPIMethods(this, [\"getVersion\", \"sign\", \"getAddressAndPubKey\", \"appInfo\", \"deviceInfo\", \"getBech32FromPK\"], scrambleKey);\n  }\n  (0, _createClass2.default)(CosmosApp, [{\n    key: \"serializePath\",\n    value: function () {\n      var _serializePath = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(path) {\n        return _regenerator.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return (0, _common.getVersion)(this.transport);\n              case 2:\n                this.versionResponse = _context.sent;\n                if (!(this.versionResponse.return_code !== _common.ERROR_CODE.NoError)) {\n                  _context.next = 5;\n                  break;\n                }\n                throw this.versionResponse;\n              case 5:\n                _context.t0 = this.versionResponse.major;\n                _context.next = _context.t0 === 1 ? 8 : _context.t0 === 2 ? 9 : 10;\n                break;\n              case 8:\n                return _context.abrupt(\"return\", (0, _helperV.serializePathv1)(path));\n              case 9:\n                return _context.abrupt(\"return\", (0, _helperV2.serializePathv2)(path));\n              case 10:\n                return _context.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function serializePath(_x) {\n        return _serializePath.apply(this, arguments);\n      }\n      return serializePath;\n    }()\n  }, {\n    key: \"signGetChunks\",\n    value: function () {\n      var _signGetChunks = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(path, message) {\n        var serializedPath, chunks, buffer, i, end;\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.serializePath(path);\n              case 2:\n                serializedPath = _context2.sent;\n                chunks = [];\n                chunks.push(serializedPath);\n                buffer = Buffer.from(message);\n                for (i = 0; i < buffer.length; i += _common.CHUNK_SIZE) {\n                  end = i + _common.CHUNK_SIZE;\n                  if (i > buffer.length) {\n                    end = buffer.length;\n                  }\n                  chunks.push(buffer.slice(i, end));\n                }\n                return _context2.abrupt(\"return\", chunks);\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n      function signGetChunks(_x2, _x3) {\n        return _signGetChunks.apply(this, arguments);\n      }\n      return signGetChunks;\n    }()\n  }, {\n    key: \"getVersion\",\n    value: function () {\n      var _getVersion2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {\n        return _regenerator.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return (0, _common.getVersion)(this.transport);\n              case 3:\n                this.versionResponse = _context3.sent;\n                return _context3.abrupt(\"return\", this.versionResponse);\n              case 7:\n                _context3.prev = 7;\n                _context3.t0 = _context3[\"catch\"](0);\n                return _context3.abrupt(\"return\", (0, _common.processErrorResponse)(_context3.t0));\n              case 10:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[0, 7]]);\n      }));\n      function getVersion() {\n        return _getVersion2.apply(this, arguments);\n      }\n      return getVersion;\n    }()\n  }, {\n    key: \"appInfo\",\n    value: function () {\n      var _appInfo = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4() {\n        return _regenerator.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", this.transport.send(0xb0, 0x01, 0, 0).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  var result = {};\n                  var appName = \"err\";\n                  var appVersion = \"err\";\n                  var flagLen = 0;\n                  var flagsValue = 0;\n                  if (response[0] !== 1) {\n                    // Ledger responds with format ID 1. There is no spec for any format != 1\n                    result.error_message = \"response format ID not recognized\";\n                    result.return_code = 0x9001;\n                  } else {\n                    var appNameLen = response[1];\n                    appName = response.slice(2, 2 + appNameLen).toString(\"ascii\");\n                    var idx = 2 + appNameLen;\n                    var appVersionLen = response[idx];\n                    idx += 1;\n                    appVersion = response.slice(idx, idx + appVersionLen).toString(\"ascii\");\n                    idx += appVersionLen;\n                    var appFlagsLen = response[idx];\n                    idx += 1;\n                    flagLen = appFlagsLen;\n                    flagsValue = response[idx];\n                  }\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    // //\n                    appName: appName,\n                    appVersion: appVersion,\n                    flagLen: flagLen,\n                    flagsValue: flagsValue,\n                    // eslint-disable-next-line no-bitwise\n                    flag_recovery: (flagsValue & 1) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_signed_mcu_code: (flagsValue & 2) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_onboarded: (flagsValue & 4) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_pin_validated: (flagsValue & 128) !== 0\n                  };\n                }, _common.processErrorResponse));\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n      function appInfo() {\n        return _appInfo.apply(this, arguments);\n      }\n      return appInfo;\n    }()\n  }, {\n    key: \"deviceInfo\",\n    value: function () {\n      var _deviceInfo = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5() {\n        return _regenerator.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                return _context5.abrupt(\"return\", this.transport.send(0xe0, 0x01, 0, 0, Buffer.from([]), [_common.ERROR_CODE.NoError, 0x6e00]).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  if (returnCode === 0x6e00) {\n                    return {\n                      return_code: returnCode,\n                      error_message: \"This command is only available in the Dashboard\"\n                    };\n                  }\n                  var targetId = response.slice(0, 4).toString(\"hex\");\n                  var pos = 4;\n                  var secureElementVersionLen = response[pos];\n                  pos += 1;\n                  var seVersion = response.slice(pos, pos + secureElementVersionLen).toString();\n                  pos += secureElementVersionLen;\n                  var flagsLen = response[pos];\n                  pos += 1;\n                  var flag = response.slice(pos, pos + flagsLen).toString(\"hex\");\n                  pos += flagsLen;\n                  var mcuVersionLen = response[pos];\n                  pos += 1; // Patch issue in mcu version\n\n                  var tmp = response.slice(pos, pos + mcuVersionLen);\n                  if (tmp[mcuVersionLen - 1] === 0) {\n                    tmp = response.slice(pos, pos + mcuVersionLen - 1);\n                  }\n                  var mcuVersion = tmp.toString();\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    // //\n                    targetId: targetId,\n                    seVersion: seVersion,\n                    flag: flag,\n                    mcuVersion: mcuVersion\n                  };\n                }, _common.processErrorResponse));\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n      function deviceInfo() {\n        return _deviceInfo.apply(this, arguments);\n      }\n      return deviceInfo;\n    }()\n  }, {\n    key: \"publicKey\",\n    value: function () {\n      var _publicKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6(path) {\n        var serializedPath, data;\n        return _regenerator.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.prev = 0;\n                _context6.next = 3;\n                return this.serializePath(path);\n              case 3:\n                serializedPath = _context6.sent;\n                _context6.t0 = this.versionResponse.major;\n                _context6.next = _context6.t0 === 1 ? 7 : _context6.t0 === 2 ? 8 : 10;\n                break;\n              case 7:\n                return _context6.abrupt(\"return\", (0, _helperV.publicKeyv1)(this, serializedPath));\n              case 8:\n                data = Buffer.concat([CosmosApp.serializeHRP(\"cosmos\"), serializedPath]);\n                return _context6.abrupt(\"return\", (0, _helperV2.publicKeyv2)(this, data));\n              case 10:\n                return _context6.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n              case 11:\n                _context6.next = 16;\n                break;\n              case 13:\n                _context6.prev = 13;\n                _context6.t1 = _context6[\"catch\"](0);\n                return _context6.abrupt(\"return\", (0, _common.processErrorResponse)(_context6.t1));\n              case 16:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[0, 13]]);\n      }));\n      function publicKey(_x4) {\n        return _publicKey.apply(this, arguments);\n      }\n      return publicKey;\n    }()\n  }, {\n    key: \"getAddressAndPubKey\",\n    value: function () {\n      var _getAddressAndPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee7(path, hrp) {\n        var _this = this;\n        return _regenerator.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.prev = 0;\n                return _context7.abrupt(\"return\", this.serializePath(path).then(function (serializedPath) {\n                  var data = Buffer.concat([CosmosApp.serializeHRP(hrp), serializedPath]);\n                  return _this.transport.send(_common.CLA, _common.INS.GET_ADDR_SECP256K1, _common.P1_VALUES.ONLY_RETRIEVE, 0, data, [_common.ERROR_CODE.NoError]).then(function (response) {\n                    var errorCodeData = response.slice(-2);\n                    var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                    var compressedPk = Buffer.from(response.slice(0, 33));\n                    var bech32Address = Buffer.from(response.slice(33, -2)).toString();\n                    return {\n                      bech32_address: bech32Address,\n                      compressed_pk: compressedPk,\n                      return_code: returnCode,\n                      error_message: (0, _common.errorCodeToString)(returnCode)\n                    };\n                  }, _common.processErrorResponse);\n                }).catch(function (err) {\n                  return (0, _common.processErrorResponse)(err);\n                }));\n              case 4:\n                _context7.prev = 4;\n                _context7.t0 = _context7[\"catch\"](0);\n                return _context7.abrupt(\"return\", (0, _common.processErrorResponse)(_context7.t0));\n              case 7:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this, [[0, 4]]);\n      }));\n      function getAddressAndPubKey(_x5, _x6) {\n        return _getAddressAndPubKey.apply(this, arguments);\n      }\n      return getAddressAndPubKey;\n    }()\n  }, {\n    key: \"showAddressAndPubKey\",\n    value: function () {\n      var _showAddressAndPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee8(path, hrp) {\n        var _this2 = this;\n        return _regenerator.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.prev = 0;\n                return _context8.abrupt(\"return\", this.serializePath(path).then(function (serializedPath) {\n                  var data = Buffer.concat([CosmosApp.serializeHRP(hrp), serializedPath]);\n                  return _this2.transport.send(_common.CLA, _common.INS.GET_ADDR_SECP256K1, _common.P1_VALUES.SHOW_ADDRESS_IN_DEVICE, 0, data, [_common.ERROR_CODE.NoError]).then(function (response) {\n                    var errorCodeData = response.slice(-2);\n                    var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                    var compressedPk = Buffer.from(response.slice(0, 33));\n                    var bech32Address = Buffer.from(response.slice(33, -2)).toString();\n                    return {\n                      bech32_address: bech32Address,\n                      compressed_pk: compressedPk,\n                      return_code: returnCode,\n                      error_message: (0, _common.errorCodeToString)(returnCode)\n                    };\n                  }, _common.processErrorResponse);\n                }).catch(function (err) {\n                  return (0, _common.processErrorResponse)(err);\n                }));\n              case 4:\n                _context8.prev = 4;\n                _context8.t0 = _context8[\"catch\"](0);\n                return _context8.abrupt(\"return\", (0, _common.processErrorResponse)(_context8.t0));\n              case 7:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[0, 4]]);\n      }));\n      function showAddressAndPubKey(_x7, _x8) {\n        return _showAddressAndPubKey.apply(this, arguments);\n      }\n      return showAddressAndPubKey;\n    }()\n  }, {\n    key: \"signSendChunk\",\n    value: function () {\n      var _signSendChunk = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee9(chunkIdx, chunkNum, chunk) {\n        return _regenerator.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.t0 = this.versionResponse.major;\n                _context9.next = _context9.t0 === 1 ? 3 : _context9.t0 === 2 ? 4 : 5;\n                break;\n              case 3:\n                return _context9.abrupt(\"return\", (0, _helperV.signSendChunkv1)(this, chunkIdx, chunkNum, chunk));\n              case 4:\n                return _context9.abrupt(\"return\", (0, _helperV2.signSendChunkv2)(this, chunkIdx, chunkNum, chunk));\n              case 5:\n                return _context9.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n              case 6:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n      function signSendChunk(_x9, _x10, _x11) {\n        return _signSendChunk.apply(this, arguments);\n      }\n      return signSendChunk;\n    }()\n  }, {\n    key: \"sign\",\n    value: function () {\n      var _sign = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee11(path, message) {\n        var _this3 = this;\n        return _regenerator.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                return _context11.abrupt(\"return\", this.signGetChunks(path, message).then(function (chunks) {\n                  return _this3.signSendChunk(1, chunks.length, chunks[0], [_common.ERROR_CODE.NoError]).then( /*#__PURE__*/function () {\n                    var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee10(response) {\n                      var result, i;\n                      return _regenerator.default.wrap(function _callee10$(_context10) {\n                        while (1) {\n                          switch (_context10.prev = _context10.next) {\n                            case 0:\n                              result = {\n                                return_code: response.return_code,\n                                error_message: response.error_message,\n                                signature: null\n                              };\n                              i = 1;\n                            case 2:\n                              if (!(i < chunks.length)) {\n                                _context10.next = 11;\n                                break;\n                              }\n                              _context10.next = 5;\n                              return _this3.signSendChunk(1 + i, chunks.length, chunks[i]);\n                            case 5:\n                              result = _context10.sent;\n                              if (!(result.return_code !== _common.ERROR_CODE.NoError)) {\n                                _context10.next = 8;\n                                break;\n                              }\n                              return _context10.abrupt(\"break\", 11);\n                            case 8:\n                              i += 1;\n                              _context10.next = 2;\n                              break;\n                            case 11:\n                              return _context10.abrupt(\"return\", {\n                                return_code: result.return_code,\n                                error_message: result.error_message,\n                                // ///\n                                signature: result.signature\n                              });\n                            case 12:\n                            case \"end\":\n                              return _context10.stop();\n                          }\n                        }\n                      }, _callee10);\n                    }));\n                    return function (_x14) {\n                      return _ref.apply(this, arguments);\n                    };\n                  }(), _common.processErrorResponse);\n                }, _common.processErrorResponse));\n              case 1:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n      function sign(_x12, _x13) {\n        return _sign.apply(this, arguments);\n      }\n      return sign;\n    }()\n  }], [{\n    key: \"serializeHRP\",\n    value: function serializeHRP(hrp) {\n      if (hrp == null || hrp.length < 3 || hrp.length > 83) {\n        throw new Error(\"Invalid HRP\");\n      }\n      var buf = Buffer.alloc(1 + hrp.length);\n      buf.writeUInt8(hrp.length, 0);\n      buf.write(hrp, 1);\n      return buf;\n    }\n  }, {\n    key: \"getBech32FromPK\",\n    value: function getBech32FromPK(hrp, pk) {\n      if (pk.length !== 33) {\n        throw new Error(\"expected compressed public key [31 bytes]\");\n      }\n      var hashSha256 = _crypto.default.createHash(\"sha256\").update(pk).digest();\n      var hashRip = new _ripemd.default().update(hashSha256).digest();\n      return _bech.default.encode(hrp, _bech.default.toWords(hashRip));\n    }\n  }]);\n  return CosmosApp;\n}();\nexports.default = CosmosApp;","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_regenerator","_asyncToGenerator2","_classCallCheck2","_createClass2","_crypto","_ripemd","_bech","_helperV","_helperV2","_common","CosmosApp","transport","scrambleKey","arguments","length","undefined","APP_KEY","Error","decorateAppAPIMethods","key","_serializePath","mark","_callee","path","wrap","_callee$","_context","prev","next","getVersion","versionResponse","sent","return_code","ERROR_CODE","NoError","t0","major","abrupt","serializePathv1","serializePathv2","error_message","stop","serializePath","_x","apply","_signGetChunks","_callee2","message","serializedPath","chunks","buffer","i","end","_callee2$","_context2","push","Buffer","from","CHUNK_SIZE","slice","signGetChunks","_x2","_x3","_getVersion2","_callee3","_callee3$","_context3","processErrorResponse","_appInfo","_callee4","_callee4$","_context4","send","then","response","errorCodeData","returnCode","result","appName","appVersion","flagLen","flagsValue","appNameLen","toString","idx","appVersionLen","appFlagsLen","errorCodeToString","flag_recovery","flag_signed_mcu_code","flag_onboarded","flag_pin_validated","appInfo","_deviceInfo","_callee5","_callee5$","_context5","targetId","pos","secureElementVersionLen","seVersion","flagsLen","flag","mcuVersionLen","tmp","mcuVersion","deviceInfo","_publicKey","_callee6","data","_callee6$","_context6","publicKeyv1","concat","serializeHRP","publicKeyv2","t1","publicKey","_x4","_getAddressAndPubKey","_callee7","hrp","_this","_callee7$","_context7","CLA","INS","GET_ADDR_SECP256K1","P1_VALUES","ONLY_RETRIEVE","compressedPk","bech32Address","bech32_address","compressed_pk","catch","err","getAddressAndPubKey","_x5","_x6","_showAddressAndPubKey","_callee8","_this2","_callee8$","_context8","SHOW_ADDRESS_IN_DEVICE","showAddressAndPubKey","_x7","_x8","_signSendChunk","_callee9","chunkIdx","chunkNum","chunk","_callee9$","_context9","signSendChunkv1","signSendChunkv2","signSendChunk","_x9","_x10","_x11","_sign","_callee11","_this3","_callee11$","_context11","_ref","_callee10","_callee10$","_context10","signature","_x14","sign","_x12","_x13","buf","alloc","writeUInt8","write","getBech32FromPK","pk","hashSha256","createHash","update","digest","hashRip","encode","toWords"],"sources":["/Users/seanwavy/Development/legends/event-usher-application/components/react/client/node_modules/ledger-cosmos-js/dist/index.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nvar _ripemd = _interopRequireDefault(require(\"ripemd160\"));\n\nvar _bech = _interopRequireDefault(require(\"bech32\"));\n\nvar _helperV = require(\"./helperV1\");\n\nvar _helperV2 = require(\"./helperV2\");\n\nvar _common = require(\"./common\");\n\n/** ******************************************************************************\n *  (c) 2019 ZondaX GmbH\n *  (c) 2016-2017 Ledger\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n ******************************************************************************* */\nvar CosmosApp = /*#__PURE__*/function () {\n  function CosmosApp(transport) {\n    var scrambleKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _common.APP_KEY;\n    (0, _classCallCheck2.default)(this, CosmosApp);\n\n    if (!transport) {\n      throw new Error(\"Transport has not been defined\");\n    }\n\n    this.transport = transport;\n    transport.decorateAppAPIMethods(this, [\"getVersion\", \"sign\", \"getAddressAndPubKey\", \"appInfo\", \"deviceInfo\", \"getBech32FromPK\"], scrambleKey);\n  }\n\n  (0, _createClass2.default)(CosmosApp, [{\n    key: \"serializePath\",\n    value: function () {\n      var _serializePath = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(path) {\n        return _regenerator.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return (0, _common.getVersion)(this.transport);\n\n              case 2:\n                this.versionResponse = _context.sent;\n\n                if (!(this.versionResponse.return_code !== _common.ERROR_CODE.NoError)) {\n                  _context.next = 5;\n                  break;\n                }\n\n                throw this.versionResponse;\n\n              case 5:\n                _context.t0 = this.versionResponse.major;\n                _context.next = _context.t0 === 1 ? 8 : _context.t0 === 2 ? 9 : 10;\n                break;\n\n              case 8:\n                return _context.abrupt(\"return\", (0, _helperV.serializePathv1)(path));\n\n              case 9:\n                return _context.abrupt(\"return\", (0, _helperV2.serializePathv2)(path));\n\n              case 10:\n                return _context.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function serializePath(_x) {\n        return _serializePath.apply(this, arguments);\n      }\n\n      return serializePath;\n    }()\n  }, {\n    key: \"signGetChunks\",\n    value: function () {\n      var _signGetChunks = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(path, message) {\n        var serializedPath, chunks, buffer, i, end;\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.serializePath(path);\n\n              case 2:\n                serializedPath = _context2.sent;\n                chunks = [];\n                chunks.push(serializedPath);\n                buffer = Buffer.from(message);\n\n                for (i = 0; i < buffer.length; i += _common.CHUNK_SIZE) {\n                  end = i + _common.CHUNK_SIZE;\n\n                  if (i > buffer.length) {\n                    end = buffer.length;\n                  }\n\n                  chunks.push(buffer.slice(i, end));\n                }\n\n                return _context2.abrupt(\"return\", chunks);\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function signGetChunks(_x2, _x3) {\n        return _signGetChunks.apply(this, arguments);\n      }\n\n      return signGetChunks;\n    }()\n  }, {\n    key: \"getVersion\",\n    value: function () {\n      var _getVersion2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {\n        return _regenerator.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return (0, _common.getVersion)(this.transport);\n\n              case 3:\n                this.versionResponse = _context3.sent;\n                return _context3.abrupt(\"return\", this.versionResponse);\n\n              case 7:\n                _context3.prev = 7;\n                _context3.t0 = _context3[\"catch\"](0);\n                return _context3.abrupt(\"return\", (0, _common.processErrorResponse)(_context3.t0));\n\n              case 10:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[0, 7]]);\n      }));\n\n      function getVersion() {\n        return _getVersion2.apply(this, arguments);\n      }\n\n      return getVersion;\n    }()\n  }, {\n    key: \"appInfo\",\n    value: function () {\n      var _appInfo = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4() {\n        return _regenerator.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", this.transport.send(0xb0, 0x01, 0, 0).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                  var result = {};\n                  var appName = \"err\";\n                  var appVersion = \"err\";\n                  var flagLen = 0;\n                  var flagsValue = 0;\n\n                  if (response[0] !== 1) {\n                    // Ledger responds with format ID 1. There is no spec for any format != 1\n                    result.error_message = \"response format ID not recognized\";\n                    result.return_code = 0x9001;\n                  } else {\n                    var appNameLen = response[1];\n                    appName = response.slice(2, 2 + appNameLen).toString(\"ascii\");\n                    var idx = 2 + appNameLen;\n                    var appVersionLen = response[idx];\n                    idx += 1;\n                    appVersion = response.slice(idx, idx + appVersionLen).toString(\"ascii\");\n                    idx += appVersionLen;\n                    var appFlagsLen = response[idx];\n                    idx += 1;\n                    flagLen = appFlagsLen;\n                    flagsValue = response[idx];\n                  }\n\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    // //\n                    appName: appName,\n                    appVersion: appVersion,\n                    flagLen: flagLen,\n                    flagsValue: flagsValue,\n                    // eslint-disable-next-line no-bitwise\n                    flag_recovery: (flagsValue & 1) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_signed_mcu_code: (flagsValue & 2) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_onboarded: (flagsValue & 4) !== 0,\n                    // eslint-disable-next-line no-bitwise\n                    flag_pin_validated: (flagsValue & 128) !== 0\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function appInfo() {\n        return _appInfo.apply(this, arguments);\n      }\n\n      return appInfo;\n    }()\n  }, {\n    key: \"deviceInfo\",\n    value: function () {\n      var _deviceInfo = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5() {\n        return _regenerator.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                return _context5.abrupt(\"return\", this.transport.send(0xe0, 0x01, 0, 0, Buffer.from([]), [_common.ERROR_CODE.NoError, 0x6e00]).then(function (response) {\n                  var errorCodeData = response.slice(-2);\n                  var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n\n                  if (returnCode === 0x6e00) {\n                    return {\n                      return_code: returnCode,\n                      error_message: \"This command is only available in the Dashboard\"\n                    };\n                  }\n\n                  var targetId = response.slice(0, 4).toString(\"hex\");\n                  var pos = 4;\n                  var secureElementVersionLen = response[pos];\n                  pos += 1;\n                  var seVersion = response.slice(pos, pos + secureElementVersionLen).toString();\n                  pos += secureElementVersionLen;\n                  var flagsLen = response[pos];\n                  pos += 1;\n                  var flag = response.slice(pos, pos + flagsLen).toString(\"hex\");\n                  pos += flagsLen;\n                  var mcuVersionLen = response[pos];\n                  pos += 1; // Patch issue in mcu version\n\n                  var tmp = response.slice(pos, pos + mcuVersionLen);\n\n                  if (tmp[mcuVersionLen - 1] === 0) {\n                    tmp = response.slice(pos, pos + mcuVersionLen - 1);\n                  }\n\n                  var mcuVersion = tmp.toString();\n                  return {\n                    return_code: returnCode,\n                    error_message: (0, _common.errorCodeToString)(returnCode),\n                    // //\n                    targetId: targetId,\n                    seVersion: seVersion,\n                    flag: flag,\n                    mcuVersion: mcuVersion\n                  };\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function deviceInfo() {\n        return _deviceInfo.apply(this, arguments);\n      }\n\n      return deviceInfo;\n    }()\n  }, {\n    key: \"publicKey\",\n    value: function () {\n      var _publicKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6(path) {\n        var serializedPath, data;\n        return _regenerator.default.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.prev = 0;\n                _context6.next = 3;\n                return this.serializePath(path);\n\n              case 3:\n                serializedPath = _context6.sent;\n                _context6.t0 = this.versionResponse.major;\n                _context6.next = _context6.t0 === 1 ? 7 : _context6.t0 === 2 ? 8 : 10;\n                break;\n\n              case 7:\n                return _context6.abrupt(\"return\", (0, _helperV.publicKeyv1)(this, serializedPath));\n\n              case 8:\n                data = Buffer.concat([CosmosApp.serializeHRP(\"cosmos\"), serializedPath]);\n                return _context6.abrupt(\"return\", (0, _helperV2.publicKeyv2)(this, data));\n\n              case 10:\n                return _context6.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n\n              case 11:\n                _context6.next = 16;\n                break;\n\n              case 13:\n                _context6.prev = 13;\n                _context6.t1 = _context6[\"catch\"](0);\n                return _context6.abrupt(\"return\", (0, _common.processErrorResponse)(_context6.t1));\n\n              case 16:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[0, 13]]);\n      }));\n\n      function publicKey(_x4) {\n        return _publicKey.apply(this, arguments);\n      }\n\n      return publicKey;\n    }()\n  }, {\n    key: \"getAddressAndPubKey\",\n    value: function () {\n      var _getAddressAndPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee7(path, hrp) {\n        var _this = this;\n\n        return _regenerator.default.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.prev = 0;\n                return _context7.abrupt(\"return\", this.serializePath(path).then(function (serializedPath) {\n                  var data = Buffer.concat([CosmosApp.serializeHRP(hrp), serializedPath]);\n                  return _this.transport.send(_common.CLA, _common.INS.GET_ADDR_SECP256K1, _common.P1_VALUES.ONLY_RETRIEVE, 0, data, [_common.ERROR_CODE.NoError]).then(function (response) {\n                    var errorCodeData = response.slice(-2);\n                    var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                    var compressedPk = Buffer.from(response.slice(0, 33));\n                    var bech32Address = Buffer.from(response.slice(33, -2)).toString();\n                    return {\n                      bech32_address: bech32Address,\n                      compressed_pk: compressedPk,\n                      return_code: returnCode,\n                      error_message: (0, _common.errorCodeToString)(returnCode)\n                    };\n                  }, _common.processErrorResponse);\n                }).catch(function (err) {\n                  return (0, _common.processErrorResponse)(err);\n                }));\n\n              case 4:\n                _context7.prev = 4;\n                _context7.t0 = _context7[\"catch\"](0);\n                return _context7.abrupt(\"return\", (0, _common.processErrorResponse)(_context7.t0));\n\n              case 7:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this, [[0, 4]]);\n      }));\n\n      function getAddressAndPubKey(_x5, _x6) {\n        return _getAddressAndPubKey.apply(this, arguments);\n      }\n\n      return getAddressAndPubKey;\n    }()\n  }, {\n    key: \"showAddressAndPubKey\",\n    value: function () {\n      var _showAddressAndPubKey = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee8(path, hrp) {\n        var _this2 = this;\n\n        return _regenerator.default.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.prev = 0;\n                return _context8.abrupt(\"return\", this.serializePath(path).then(function (serializedPath) {\n                  var data = Buffer.concat([CosmosApp.serializeHRP(hrp), serializedPath]);\n                  return _this2.transport.send(_common.CLA, _common.INS.GET_ADDR_SECP256K1, _common.P1_VALUES.SHOW_ADDRESS_IN_DEVICE, 0, data, [_common.ERROR_CODE.NoError]).then(function (response) {\n                    var errorCodeData = response.slice(-2);\n                    var returnCode = errorCodeData[0] * 256 + errorCodeData[1];\n                    var compressedPk = Buffer.from(response.slice(0, 33));\n                    var bech32Address = Buffer.from(response.slice(33, -2)).toString();\n                    return {\n                      bech32_address: bech32Address,\n                      compressed_pk: compressedPk,\n                      return_code: returnCode,\n                      error_message: (0, _common.errorCodeToString)(returnCode)\n                    };\n                  }, _common.processErrorResponse);\n                }).catch(function (err) {\n                  return (0, _common.processErrorResponse)(err);\n                }));\n\n              case 4:\n                _context8.prev = 4;\n                _context8.t0 = _context8[\"catch\"](0);\n                return _context8.abrupt(\"return\", (0, _common.processErrorResponse)(_context8.t0));\n\n              case 7:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[0, 4]]);\n      }));\n\n      function showAddressAndPubKey(_x7, _x8) {\n        return _showAddressAndPubKey.apply(this, arguments);\n      }\n\n      return showAddressAndPubKey;\n    }()\n  }, {\n    key: \"signSendChunk\",\n    value: function () {\n      var _signSendChunk = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee9(chunkIdx, chunkNum, chunk) {\n        return _regenerator.default.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.t0 = this.versionResponse.major;\n                _context9.next = _context9.t0 === 1 ? 3 : _context9.t0 === 2 ? 4 : 5;\n                break;\n\n              case 3:\n                return _context9.abrupt(\"return\", (0, _helperV.signSendChunkv1)(this, chunkIdx, chunkNum, chunk));\n\n              case 4:\n                return _context9.abrupt(\"return\", (0, _helperV2.signSendChunkv2)(this, chunkIdx, chunkNum, chunk));\n\n              case 5:\n                return _context9.abrupt(\"return\", {\n                  return_code: 0x6400,\n                  error_message: \"App Version is not supported\"\n                });\n\n              case 6:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function signSendChunk(_x9, _x10, _x11) {\n        return _signSendChunk.apply(this, arguments);\n      }\n\n      return signSendChunk;\n    }()\n  }, {\n    key: \"sign\",\n    value: function () {\n      var _sign = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee11(path, message) {\n        var _this3 = this;\n\n        return _regenerator.default.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                return _context11.abrupt(\"return\", this.signGetChunks(path, message).then(function (chunks) {\n                  return _this3.signSendChunk(1, chunks.length, chunks[0], [_common.ERROR_CODE.NoError]).then( /*#__PURE__*/function () {\n                    var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee10(response) {\n                      var result, i;\n                      return _regenerator.default.wrap(function _callee10$(_context10) {\n                        while (1) {\n                          switch (_context10.prev = _context10.next) {\n                            case 0:\n                              result = {\n                                return_code: response.return_code,\n                                error_message: response.error_message,\n                                signature: null\n                              };\n                              i = 1;\n\n                            case 2:\n                              if (!(i < chunks.length)) {\n                                _context10.next = 11;\n                                break;\n                              }\n\n                              _context10.next = 5;\n                              return _this3.signSendChunk(1 + i, chunks.length, chunks[i]);\n\n                            case 5:\n                              result = _context10.sent;\n\n                              if (!(result.return_code !== _common.ERROR_CODE.NoError)) {\n                                _context10.next = 8;\n                                break;\n                              }\n\n                              return _context10.abrupt(\"break\", 11);\n\n                            case 8:\n                              i += 1;\n                              _context10.next = 2;\n                              break;\n\n                            case 11:\n                              return _context10.abrupt(\"return\", {\n                                return_code: result.return_code,\n                                error_message: result.error_message,\n                                // ///\n                                signature: result.signature\n                              });\n\n                            case 12:\n                            case \"end\":\n                              return _context10.stop();\n                          }\n                        }\n                      }, _callee10);\n                    }));\n\n                    return function (_x14) {\n                      return _ref.apply(this, arguments);\n                    };\n                  }(), _common.processErrorResponse);\n                }, _common.processErrorResponse));\n\n              case 1:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function sign(_x12, _x13) {\n        return _sign.apply(this, arguments);\n      }\n\n      return sign;\n    }()\n  }], [{\n    key: \"serializeHRP\",\n    value: function serializeHRP(hrp) {\n      if (hrp == null || hrp.length < 3 || hrp.length > 83) {\n        throw new Error(\"Invalid HRP\");\n      }\n\n      var buf = Buffer.alloc(1 + hrp.length);\n      buf.writeUInt8(hrp.length, 0);\n      buf.write(hrp, 1);\n      return buf;\n    }\n  }, {\n    key: \"getBech32FromPK\",\n    value: function getBech32FromPK(hrp, pk) {\n      if (pk.length !== 33) {\n        throw new Error(\"expected compressed public key [31 bytes]\");\n      }\n\n      var hashSha256 = _crypto.default.createHash(\"sha256\").update(pk).digest();\n\n      var hashRip = new _ripemd.default().update(hashSha256).digest();\n      return _bech.default.encode(hrp, _bech.default.toWords(hashRip));\n    }\n  }]);\n  return CosmosApp;\n}();\n\nexports.default = CosmosApp;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}